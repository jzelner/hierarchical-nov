---
title: "Modeling clustered transmission in a large Norovirus outbreak"
author: Jon Zelner
date: \today
header-includes:
  - \usepackage{graphicx}
--- 

# Introduction

In this paper, we construct a model of norovirus (NoV) transmission during a large outbreak to understand the role of individual-level heterogeneity in infectiousness on the overall outbreak attack rate and outbreak transmission dynamics. To do this, we constructed an individual-level, stochastic statistical model of individual-level NoV transmission. To account for heterogeneity in individual infection potential, we adopted the framework originally described by Lloyd-Smith et al. [@Lloyd-Smith:2005aa] to account for the impact of *superspreading* events among emerging infectious diseases. 

# Data

We analyze data previously published by Heijne et al. [@Heijne2009] from a large Norovirus outbreak during a scout jamboree in the Netherlands in 2004. Figure \ref{fig:allcases} shows the distribution of cases over time during the outbreak, and Figure \ref{fig:campcases} shows the evolution of the outbreak within the seven individual sub-camps affected during the outbreak.

# Methods

In this section, we outline a stochastic, discrete-time model of NoV transmission within and between sub-camps of the outbreak.

## Data Model

We denote the number of incident cases observed on day $t$ in camp $j$ to be $y_{i,t}$. Individuals are assumed to be infectious at the beginning of their day of onset. We denote the day of onset of disease for individual $i$ as $z_i$. 

### Heterogeneous infectiousness 

Each case is assumed to have a *per-capita* infectiousness $\beta_i$ drawn from a gamma distribution reparameterized in terms of the expected value of the per-capita infectiousness, $\beta_{mu}$, and a shape parameter $\beta_{\alpha}$. So, $\beta_i \sim Gamma(\beta_{\mu}, \beta_{\alpha})$. 

Because within each camp multiple cases may become infectious on a given day, the values of $\beta_i$ are not individually identifiable. However, we can take advantage of the fact that the sum of $n$ Gamma-distributed variables is Gamma distributed with mean $\beta_{\mu} \times n$ to sample values $\beta_{jt}$ indicating the daily average per-capita infectiousness across all individuals who became infectious in camp $j$ on day $t$. 

### Time-varying infectiousness

We allow individual infectiousness to decay according to a Geometric distribution with parameter $\gamma \in (0,1]$, where:

$$
g(x | \gamma) = \gamma (1-\gamma)^x 
$$

When $t \ge z_i$, $g(t-z_i)$ is the proportion of the infectiousness of individual $i$ deposited on day $t$. Otherwise, when $t < z_i$, this value is equal to zero, i.e. before the individual becomes infectious. The parameter $\gamma$ has a straightforward interpretation as the proportion of the individual's infectiousness deposited on the day of symptom onset, and the proportion of *remaining* infectiousness deposited each day thereafter.

### Force of infection

We denote the parameter $\zeta$ to be the ratio of an individual's per-capita infectiousness for within-camp contacts ($i = j$) vs. outside-camp contacts ($i \ne j$).  We denote the force of infection in camp $j$ at time $t$ as $\lambda_{j,t}$ and can write this as follows:

$$
\lambda_{jt} =  \sum_{k \le t}\left( \zeta \left({r_{jk} y_{jk}}\right) g(t-k) + \sum_{i \ne j}\left(r_{ik} y_{ik}\right) g(t-k)\right)
$$

### Likelihood

The likelihood of observing *each* of the $y_{jt}$ cases in camp $j$ on day $t > 1$ is a function of three components: 

1) Likelihood of escaping infection from $t=1$ until the time of infection for case $i$, $t_{i}^*$.

2) Likelihood of infection in camp $j$ at $t = t^*_i$, and,

3) Likelihood of latent period of duration $z_i - t_i^*$, where $z_i$ is the time of onset for case $i$.

The total system likelihood involves a fourth component:

4 ) Likelihood that the $S_j$ individuals in camp $j$ who did not develop disease during the observation period escaped infection from $t = 1$ until time $T$, when the jamboree ended.

The probability that an individual is infected at time $t_i^*$ is a function of a piecewise exponential likelihood, i.e. 1 and 2 above:

$$ 
Pr(t = t^*_{ij}) = \left(1- e^{-\lambda_{jt}}\right) exp\left(-\sum_{i = 1}^{i < t} \lambda_{ji}\right)
$$


The probability that an individual has a latent period of $z_i - t_i^*$ is described by a geometric distribution with rate parameter $\epsilon$:

$$
Pr(x  = z_i-t^*_{ij}) = \epsilon (1-\epsilon)^{(z_i-t^*_{ij}-1)}
$$

For case $i$, the marginal probability - summing over all possible latent periods - that $t = z_i$ is:

$$
Pr(z_i = t) = \sum_{j = 1}^{z_i - 1} \frac{Pr(j = t^*_{ij}) Pr(x = z_i-j)}{\sum_{k = 1}^{z_i-1}{Pr(x = z_i - k)}}
$$

Then, for all camps, $j$, the probability of observing $y_j2$ cases on day 2, $y_j3$ on day 3, etc, is:

$$
Pr(y_{jt}) = \prod_{i = 1}^{C} \prod_{t = 1}^{T} y_{it} Pr(z_i = i)
$$

## Calculating reproduction numbers

We can calculate the individual reproduction number for each infectious individual by multiplying the baseline per-capita rate of infection by the number of people each infectious individual is exposed to both within their camp of residence, and in other camps, as follows:

$$
r_{jt} = \beta_{jt} \left(\zeta n_j + \sum_{i \ne j}^{C} n_i\right)
$$

# Results
```{r, warning=FALSE, message=FALSE, echo=FALSE}
require(readr)
require(dplyr)
## Load pars

z <- read_csv("../output/scalar_pars.csv")


zeta <- z %>% filter(par == "zeta")

beta <- z %>% filter(par == "log_beta_mu")
beta_shape <- z%>% filter(par == "beta_shape")
```

Individuals deposit approximately `r sprintf("%0.0f", 100*zeta[,"median"])` percent of their infectiousness within their camp of residence (95% CI = `r sprintf("%0.0f, %0.0f", 100*zeta[,"low_ci"], 100*zeta[,"high_ci"])`).

The average value of R across all individuals is `r sprintf("%0.2f", exp(beta[,"median"]))` (95% CI = `r sprintf("%0.2f, %0.2f", exp(beta[,"low_ci"]), exp(beta[,"high_ci"]))`). However, the value of $r_i$ across individuals is highly dispersed $\alpha$ = `r sprintf("%0.2f", beta_shape[,"median"])` (95% CI = `r sprintf("%0.2f, %0.2f", beta_shape[,"low_ci"], beta_shape[,"high_ci"])`), indicating wide heterogeneity in infectious across individuals.



# Figures & Tables

\begin{figure}[h]
\centering
\includegraphics[width=0.6\textwidth]{output/figures/all_camp_cases.pdf}
\caption{Number of new cases per day. Vertical line indicates beginning of hygiene interventions.}
\label{fig:allcases}
\end{figure}

\begin{figure}[h]
\centering
\includegraphics[width=0.6\textwidth]{output/figures/cases_by_camp.pdf}
\caption{Estimated daily avg. reproductive number across all camps. Dashed lines indicated 95\% posterior credible intervals. Dotted line indicates critical value of R = 1.}
\label{fig:campcases}
\end{figure}


\begin{figure}
\centering
\includegraphics[width=0.6\textwidth]{output/figures/daily_avg_r.pdf}
\caption{Estimated daily avg. reproductive number across all camps. Dashed lines indicated 95\% posterior credible intervals. Dotted line indicates critical value of R = 1.}
\label{fig:dailyr}
\end{figure}

\begin{figure}
\centering
\includegraphics[width=0.7\textwidth]{output/figures/daily_camp_r.pdf}
\caption{Estimated daily avg. reproductive number for each camp.Vertical bar indicates beginning of hygiene interventions.}
\label{fig:campr}
\end{figure}

\newpage

# References
